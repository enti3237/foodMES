Imports Excel = Microsoft.Office.Interop.Excel
Imports System.Runtime.InteropServices
Imports System.Reflection
Public Class Frm_CM_Order

    'hsim 20200508 사용 테이블 저장용 변수 선언
    '#1. 사용자 테이블
    Dim tblCmOrder As New DataTable
    Dim tblCmOrderList As New DataTable

    Dim prcType As New String(String.Empty)
    Dim histLogStr As New String(String.Empty)
    Dim fmtStr As New String(String.Format("yyyy-MM-dd")), fmtStr2 As New String(String.Format("yyyy-MM-dd HH:mm:ss"))

    Dim xlapp As New Excel.Application
    Dim xlbook As Excel.Workbook
    Dim xlsheet As Excel.Worksheet
    Dim xRange As Excel.Range
    Dim xlotno As String

    Dim Excel_Check As Boolean

    Private Sub Frm_CM_Order_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Me.Dock = DockStyle.Fill
        Me.BringToFront()

        palMain.Top = 40
        palMain.Left = 10
        palDetail.Top = 40
        palDetail.Left = 10
        Panel7.Top = 40
        Panel7.Left = 10
        palSelect.Top = 200
        palSelect.Left = 300

        palMain.Visible = True
        palDetail.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False

        '#1. 사용자 테이블
        tblCmOrder = fnGetTableStructure("CM_Order")
        tblCmOrderList = fnGetTableStructure("CM_Order_List")

        comboSetUp1(cboItmUnit3, "1050")

        CM_Load()
    End Sub

    Private Sub Com_Contract_Click(sender As Object, e As EventArgs) Handles btnMain.Click
        Label_Color(sender, Color_Label, Di_Panel2)
        palMain.Visible = True
        palDetail.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False
    End Sub

    Private Sub Com_Excel_Click(sender As Object, e As EventArgs) Handles btnDetail.Click
        Label_Color(sender, Color_Label, Di_Panel2)
        palMain.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False
        palDetail.Visible = True
    End Sub

    Private Sub Text_Clear()
        txtJobNo2.Text = ""
        txtLOCode2.Text = ""
        txtPSCode2.Text = ""
        txtVendorName2.Text = ""
        txtDeliverPlace2.Text = ""
        txtCondition2.Text = ""
        txtPOCode2.Text = ""
        txtPOItmCode3.Text = ""
        txtDWGCode3.Text = ""
        cboItmUnit3.Text = ""
        txtQTY3.Text = ""
        txtUPrice3.Text = ""
        txtItmTotal3.Text = ""
        dtpDelivery3.Text = ""
        dtpDeliver2.Text = ""
        txtBigo2.Text = ""
        txtPrepared2.Text = ""
        txtReviewedMS2.Text = ""
        txtApprov2.Text = ""
    End Sub

    Private Sub Button10_Click(sender As Object, e As EventArgs)
        Text_Clear()
        Label_Color(btnDetail, Color_Label, Di_Panel2)
        palMain.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False
        palDetail.Visible = True
    End Sub

    Private Sub Com_Can_Click(sender As Object, e As EventArgs)
        Text_Clear()
        Label_Color(btnMain, Color_Label, Di_Panel2)
        palMain.Visible = True
        palDetail.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False
    End Sub

    Private Sub CM_Load()
        btnSearch.PerformClick()
    End Sub

    Private Sub CM_Detail_Load()

        palMain.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False
        palDetail.Visible = True

        Dim DBT As DataTable
        DBT = Nothing

        StrSQL = " SELECT COL.CO_List_Code, COL.CO_Code, COL.CO_Rev_No, COL.CO_Sun, " &
                 " COL.CO_Itm_Code, COL.CO_Itm_Name, COL.CO_Itm_Material, COL.CO_Itm_Spec, COL.CO_DV_Code, COL.CO_Itm_Unit, " &
                 " isnull(COL.CO_Itm_Qty,0) CO_Itm_Qty, isnull(COL.CO_Itm_Unit_Price,0) CO_Itm_Unit_Price, isnull(COL.CO_Itm_Total,0) CO_Itm_Total, " &
                 " COL.CO_Itm_Delivery_Date, COL.CO_Itm_Bigo, COL.CO_Prepared, COL.CO_Updated, COL.CO_Insu, COL.CO_Prepare_Date, COL.CO_Update_Date, COL.CO_Insu_Date " &
                 " ,(select DV.DV_Name from DV_Drawing DV where COL.CO_DV_Code <> '' And DV.DV_Code = COL.CO_DV_Code And DV.DV_Rev_No = (select isnull(Max(DV_Rev_No),1) from DV_Drawing where DV_Code = DV.DV_Code)) CO_DV_Name " &
                 ", (select Base_Name from Base_Code where Base_Sel_Code = '1050' and Base_Code = COL.CO_Itm_Unit ) CO_Itm_Unit_Name " & '수량 단위"
                 " ,(select Man_Name from Man where COL.CO_Prepared <> '' And Man_Code = COL.CO_Prepared) CO_Prepared_Name " &
                 " ,(select Man_Name from Man where COL.CO_Updated <> '' And Man_Code = COL.CO_Updated) CO_Updated_Name " &
                 " ,(select Man_Name from Man where COL.CO_Insu <> '' And Man_Code = COL.CO_Insu) CO_Insu_Name " &
                 " FROM CM_Order_List COL where 1=1 " &
                 " And COL.CO_Code = '" & lstMain.Rows(lstMain.CurrentCellAddress.Y).Cells("CO_Code").Value.ToString & "'" &
                 " And COL.CO_Rev_No = " & lstMain.Rows(lstMain.CurrentCellAddress.Y).Cells("CO_Rev_No").Value.ToString &
                 " order By COL.CO_Code, COL.CO_Rev_No, COL.CO_Sun "

        Console.WriteLine("PO세부내용 SQL : " & StrSQL)
        Re_Count = DB_Select(DBT)

        lstDetail.DataSource = DBT
        lstDetail.ClearSelection()

    End Sub

    Private Sub lstMain_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles lstMain.CellDoubleClick

        Label_Color(sender, Color_Label, Di_Panel2)
        palMain.Visible = False
        Panel7.Visible = False
        palSelect.Visible = False
        palDetail.Visible = True


        Dim DBT As DataTable
        DBT = Nothing

        StrSQL = " SELECT COL.CO_List_Code, COL.CO_Code, COL.CO_Rev_No, COL.CO_Sun, " &
                 " COL.CO_Itm_Code, COL.CO_Itm_Name, COL.CO_Itm_Material, COL.CO_Itm_Spec, COL.CO_DV_Code, COL.CO_Itm_Unit, " &
                 " isnull(COL.CO_Itm_Qty,0) CO_Itm_Qty, isnull(COL.CO_Itm_Unit_Price,0) CO_Itm_Unit_Price, isnull(COL.CO_Itm_Total,0) CO_Itm_Total, " &
                 " COL.CO_Itm_Delivery_Date, COL.CO_Itm_Bigo, COL.CO_Prepared, COL.CO_Updated, COL.CO_Insu, COL.CO_Prepare_Date, COL.CO_Update_Date, COL.CO_Insu_Date " &
                 " ,(select DV.DV_Name from DV_Drawing DV where COL.CO_DV_Code <> '' And DV.DV_Code = COL.CO_DV_Code And DV.DV_Rev_No = (select isnull(Max(DV_Rev_No),1) from DV_Drawing where DV_Code = DV.DV_Code)) CO_DV_Name " &
                 ", (select Base_Name from Base_Code where Base_Sel_Code = '1050' and Base_Code = COL.CO_Itm_Unit ) CO_Itm_Unit_Name " & '수량 단위"
                 " ,(select Man_Name from Man where COL.CO_Prepared <> '' And Man_Code = COL.CO_Prepared) CO_Prepared_Name " &
                 " ,(select Man_Name from Man where COL.CO_Updated <> '' And Man_Code = COL.CO_Updated) CO_Updated_Name " &
                 " ,(select Man_Name from Man where COL.CO_Insu <> '' And Man_Code = COL.CO_Insu) CO_Insu_Name " &
                 " FROM CM_Order_List COL where 1=1 " &
                 " And COL.CO_Code = '" & lstMain.Rows(lstMain.CurrentCellAddress.Y).Cells("CO_Code").Value.ToString & "'" &
                 " And COL.CO_Rev_No = " & lstMain.Rows(lstMain.CurrentCellAddress.Y).Cells("CO_Rev_No").Value.ToString &
                 " order By COL.CO_Code, COL.CO_Rev_No, COL.CO_Sun "

        Console.WriteLine("PO세부내용 SQL : " & StrSQL)
        Re_Count = DB_Select(DBT)

        lstDetail.DataSource = DBT
        lstDetail.ClearSelection()

    End Sub

    Private Sub lstMain_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles lstMain.CellClick
        Dim cboDBT As New DataTable(), cboDBT2 As New DataTable(),
            cboDBT3 As New DataTable(), cboDBT4 As New DataTable(),
            cboDBT5 As New DataTable()

        txtJobNo2.Text = lstMain.Rows(e.RowIndex).Cells("CO_CR_Code").Value.ToString
        txtJobRev2.Text = lstMain.Rows(e.RowIndex).Cells("CR_Rev_No").Value.ToString
        txtJobName2.Text = lstMain.Rows(e.RowIndex).Cells("CR_Name").Value.ToString
        txtPOCode2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Code").Value.ToString
        txtPOName2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Name").Value.ToString
        txtRev2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Rev_No").Value.ToString
        dtpRegDate2.Value = lstMain.Rows(e.RowIndex).Cells("CO_Date").Value.ToString
        txtLOCode2.Text = lstMain.Rows(e.RowIndex).Cells("CO_LO_Code").Value.ToString
        txtLORev2.Text = lstMain.Rows(e.RowIndex).Cells("CO_LO_Rev_No").Value.ToString
        txtPSCode2.Text = lstMain.Rows(e.RowIndex).Cells("CO_PS_Code").Value.ToString
        txtPSRev2.Text = lstMain.Rows(e.RowIndex).Cells("CO_PS_Rev_No").Value.ToString
        txtVendorCode2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Customer_Code").Value.ToString
        txtVendorName2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Customer_Name").Value.ToString
        dtpDeliver2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Deliver").Value.ToString
        txtDeliverPlace2.Text = lstMain.Rows(e.RowIndex).Cells("CO_WH").Value.ToString
        txtCondition2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Condition").Value.ToString
        txtBigo2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Bigo").Value.ToString
        '#1.작성자
        cboDBT.Columns.Add("Man_Code")
        cboDBT.Columns.Add("Man_Name")
        cboDBT.Rows.Add()
        cboDBT.Rows(0).Item(0) = lstMain.Rows(e.RowIndex).Cells("CO_Prepared").Value.ToString
        cboDBT.Rows(0).Item(1) = lstMain.Rows(e.RowIndex).Cells("CO_Prepared_Name").Value.ToString
        cboPrepared.DataSource = cboDBT
        cboPrepared.ValueMember = "Man_Code"
        cboPrepared.DisplayMember = "Man_Name"
        cboPrepared.SelectedValue = lstMain.Rows(e.RowIndex).Cells("CO_Prepared").Value.ToString
        txtPrepared2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Prepared_Name").Value.ToString
        dtpPrepared2.Value = lstMain.Rows(e.RowIndex).Cells("CO_Prepare_Date").Value.ToString
        '#2.검토자(MS)
        cboDBT2.Columns.Add("Man_Code")
        cboDBT2.Columns.Add("Man_Name")
        cboDBT2.Rows.Add()
        cboDBT2.Rows(0).Item(0) = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_MS").Value.ToString
        cboDBT2.Rows(0).Item(1) = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_MS_Name").Value.ToString
        cboReviewedMS.DataSource = cboDBT2
        cboReviewedMS.ValueMember = "Man_Code"
        cboReviewedMS.DisplayMember = "Man_Name"
        cboReviewedMS.SelectedValue = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_MS").Value.ToString
        txtReviewedMS2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_MS_Name").Value.ToString
        dtpReviewedMS2.Value = lstMain.Rows(e.RowIndex).Cells("CO_Review_Date_MS").Value.ToString
        '#3.검토자(QA)
        cboDBT3.Columns.Add("Man_Code")
        cboDBT3.Columns.Add("Man_Name")
        cboDBT3.Rows.Add()
        cboDBT3.Rows(0).Item(0) = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_QA").Value.ToString
        cboDBT3.Rows(0).Item(1) = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_QA_Name").Value.ToString
        cboReviewedQA.DataSource = cboDBT3
        cboReviewedQA.ValueMember = "Man_Code"
        cboReviewedQA.DisplayMember = "Man_Name"
        cboReviewedQA.SelectedValue = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_QA").Value.ToString
        txtReviewedQA2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Reviewed_QA_Name").Value.ToString
        dtpReviewedQA2.Value = lstMain.Rows(e.RowIndex).Cells("CO_Review_Date_QA").Value.ToString
        '#4.승인자
        cboDBT4.Columns.Add("Man_Code")
        cboDBT4.Columns.Add("Man_Name")
        cboDBT4.Rows.Add()
        cboDBT4.Rows(0).Item(0) = lstMain.Rows(e.RowIndex).Cells("CO_Approved").Value.ToString
        cboDBT4.Rows(0).Item(1) = lstMain.Rows(e.RowIndex).Cells("CO_Approved_Name").Value.ToString
        cboApproved.DataSource = cboDBT4
        cboApproved.ValueMember = "Man_Code"
        cboApproved.DisplayMember = "Man_Name"
        cboApproved.SelectedValue = lstMain.Rows(e.RowIndex).Cells("CO_Approved").Value.ToString
        txtApprov2.Text = lstMain.Rows(e.RowIndex).Cells("CO_Approved_Name").Value.ToString
        dtpApprov2.Value = lstMain.Rows(e.RowIndex).Cells("CO_Approve_Date").Value.ToString

    End Sub


    Private Sub btnSearch_Click(sender As Object, e As EventArgs) Handles btnSearch.Click
        Dim i As Integer
        Dim DBT As DataTable, DBT2 As DataTable
        Dim itmestr As String = ""
        DBT = Nothing
        DBT2 = Nothing

        Try

            StrSQL = " SELECT " &
                 " CO.CO_Code CO_Code " &
                 ",CO.CO_Rev_No CO_Rev_No" &
                 ",CO.CO_Name CO_Name" &
                 ",CO.CO_CR_Code CO_CR_Code" &
                 ",CO.CO_PS_Code CO_PS_Code" &
                 ",CO.CO_LO_Code CO_LO_Code" &
                 ",CO.CO_Customer_Code CO_Customer_Code" &
                 ",CO.CO_Date CO_Date" &
                 ",CO.CO_Deliver CO_Deliver" &
                 ",CO.CO_WH CO_WH" &
                 ",CO.CO_Condition CO_Condition" &
                 ",CO.CO_Src_Verify_YN CO_Src_Verify_YN" &
                 ",CO.CO_Bigo CO_Bigo" &
                 ",CO.CO_Prepared CO_Prepared" &
                 ",CO.CO_Reviewed_MS CO_Reviewed_MS" &
                 ",CO.CO_Reviewed_QA CO_Reviewed_QA" &
                 ",CO.CO_Approved CO_Approved" &
                 ",CO.CO_Updated CO_Updated" &
                 ",CO.CO_Deliver_Confirmed CO_Deliver_Confirmed" &
                 ",CO.CO_Prepare_Date CO_Prepare_Date" &
                 ",CO.CO_Review_Date_MS CO_Review_Date_MS" &
                 ",CO.CO_Review_Date_QA CO_Review_Date_QA" &
                 ",CO.CO_Approve_Date CO_Approve_Date" &
                 ",CO.CO_Update_Date CO_Update_Date" &
                 ",CO.CO_Deliver_Date CO_Deliver_Date" &
                 " ,CR.CR_Code CR_Code, CR.CR_Rev_No CR_Rev_No, CR.CR_Name CR_Name " &
                 " ,(select LO_Rev_No from LA_Order where CO.CO_LO_Code <> '' and LO_Code = CO.CO_LO_Code and LO_Rev_No = (select isnull(max(LO_Rev_No),1) from LA_Order where LO_Code = CO.CO_LO_Code)) CO_LO_Rev_No " &
                 " ,(select PS_Rev_No from PS_Order_Plan where CO.CO_PS_Code <> '' and PS_Code = CO.CO_PS_Code and PS_Rev_No = (select isnull(max(PS_Rev_No),1) from PS_Order_Plan where PS_Code = CO.CO_PS_Code)) CO_PS_Rev_No " &
                 " ,(select Man_Name from Man where CO.CO_Prepared <> '' and Man_Code = CO.CO_Prepared) CO_Prepared_Name " &
                 " ,(select Man_Name from Man where CO.CO_Updated <> '' and Man_Code = CO.CO_Updated) CO_Updated_Name " &
                 " ,(select Man_Name from Man where CO.CO_Reviewed_MS <> '' and Man_Code = CO.CO_Reviewed_MS) CO_Reviewed_MS_Name " &
                 " ,(select Man_Name from Man where CO.CO_Reviewed_QA <> '' and Man_Code = CO.CO_Reviewed_QA) CO_Reviewed_QA_Name " &
                 " ,(select Man_Name from Man where CO.CO_Approved <> '' and Man_Code = CO.CO_Approved) CO_Approved_Name " &
                 " ,(select Man_Name from Man where CO.CO_Deliver_Confirmed <> '' and Man_Code = CO.CO_Deliver_Confirmed) CO_Deliver_Confirmed_Name " &
                 " ,(select CM_Name from company where CO.CO_Customer_Code <> '' and CM_Code = CO.CO_Customer_Code) CO_Customer_Name " &
                 " ,(select CM_Add1 + ' ' + CM_Add2 from company where CM_Code = CO.CO_Customer_Code) CO_Customer_Addr " &
                 " ,(select isnull(SUM(CO_Itm_Total),0) from CM_Order_List where CO_Code = CO.CO_Code And CO_Rev_No = CO.CO_Rev_No) CO_Total " &
                 " FROM CM_Order CO, CR_Contract CR " &
                 " where 1=1 " &
                 " AND CO.CO_Rev_No = (select isnull(max(CO_Rev_No),1) from CM_Order where CO_Code = CO.CO_code) " &
                 " And CO.CO_CR_Code Like '%" & txtJobNo.Text & "%' " &
                 " And CO.CO_LO_Code Like '%" & txtPRNo.Text & "%' " &
                 " And CO.CO_Code Like '%" & txtPOCode.Text & "%' " &
                 " And CO.CO_CR_Code = CR.CR_Code " &
                 " And CR.CR_Rev_No = ( select isnull(max(CR_Rev_No),1) from CR_Contract where CR_Code = CR.CR_Code) " &
                 " And CR.CR_Name like '%" & txtJobName.Text & "%' " &
                 " order by CO.CO_Code, CO.CO_CR_Code"
            Re_Count = DB_Select(DBT)

            lstMain.DataSource = DBT
            lstMain.ClearSelection()

            'hsim 20200517 이력 내역 조회
            showRevLog("Frm_CM_Order", DBT2, lstRev)

        Catch ex As Exception

            MsgBox(ex.Message)
            Exit Sub

        End Try

        'For i = 0 To lstMain.Rows.Count - 1
        '    StrSQL = "SELECT * FROM CM_Order_List where CO_Code = '" & lstMain.Rows(i).Cells("CO_Code").Value.ToString & "'"
        '    Re_Count = DB_Select(DBT)
        '    If Re_Count > 1 Then
        '        itmestr = DBT.Rows(0)("CO_PL_Name").ToString + " 외 " + (Re_Count - 1).ToString + "건"
        '    ElseIf Re_Count > 0 Then
        '        itmestr = DBT.Rows(0)("CO_PL_Name").ToString

        '    End If
        '    lstMain.Rows(i).Cells("CO_Item").Value = itmestr
        'Next
    End Sub

    Private Sub btnSub_Click(sender As Object, e As EventArgs) Handles btnSub.Click
        Label_Color(sender, Color_Label, Di_Panel2)
        palMain.Visible = False
        palDetail.Visible = False
        Panel7.Visible = False
        palSelect.Visible = True
        CM_Detail_Load()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        'Dim DBT As DataTable
        'Dim DBT2 As DataTable
        'Dim File As String = ""
        'Dim RIR As String = ""
        'Dim gold As Integer = 0
        'Dim i As Integer
        'DBT = Nothing
        'DBT2 = Nothing

        'StrSQL = "SELECT * FROM CM_Order where CO_Code = '" & xworksheet.Range("J5").Value.ToString & "'"
        'Re_Count = DB_Select(DBT)

        'If Re_Count > 0 Then
        '    StrSQL = "Update CM_Order Set CO_PS_Code = '" & xworksheet.Range("J3").Value.ToString & "',
        '                                 CO_PR_Code = '" & xworksheet.Range("J2").Value.ToString & "',
        '                                 CO_Customer_Name = '" & xworksheet.Range("C7").Value.ToString & "',
        '                                 CO_Item = '" & xworksheet.Range("B10").Value.ToString & "',
        '                                 CO_Gold = '" & xworksheet.Range("I19").Value.ToString & "',
        '                                 CO_Deliver = '" & xworksheet.Range("K10").Value.ToString & "',
        '                                 CO_WH = '" & xworksheet.Range("J7").Value.ToString & "',
        '                                 CO_Condition = '" & xworksheet.Range("J8").Value.ToString & "',
        '                                 CO_Bigo = '" & xworksheet.Range("A20").Value.ToString & "',
        '                                 CO_Prepared = '" & xworksheet.Range("J22").Value.ToString & "',
        '                                 CO_Reviewed = '" & xworksheet.Range("J25").Value.ToString + " / " + xworksheet.Range("J28").Value.ToString & "',
        '                                 CO_Approved = '" & xworksheet.Range("J31").Value.ToString & "'
        '                                 WHERE CO_Code = '" & xworksheet.Range("J5").Value.ToString & "'"
        '    Re_Count2 = DB_Execute()

        '    For i = 1 To 9
        '        If xworksheet.Range("B" + (i + 9).ToString).Value.ToString <> "" Then
        '            StrSQL = "Update CM_Order_List Set CO_PL_Code = '" & "" & "',
        '                                 CO_PL_Name = '" & xworksheet.Range("B" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_DwgNo = '" & xworksheet.Range("B" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_Unit = '" & xworksheet.Range("E" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_Qty = '" & xworksheet.Range("F" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_Amount = '" & xworksheet.Range("I" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_Unit_Amount = '" & xworksheet.Range("G" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_Total = '" & "" & "',
        '                                 CO_day01 = '" & "" & "',
        '                                 CO_Insu = '" & "" & "',
        '                                 CO_Pre_Name = '" & "" & "',
        '                                 CO_Rev_Name = '" & "" & "',
        '                                 CO_Deliver = '" & xworksheet.Range("K" + (i + 9).ToString).Value.ToString & "',
        '                                 CO_Bigo = '" & "" & "'
        '                                 WHERE CO_Code = '" & txtPOCode2.Text & "' AND CO_Sun = '" & txtSun3.Text & "'"
        '        End If
        '    Next

        '    If Re_Count2 > 0 Then
        '        MsgBox("저장 완료")

        '    Else
        '        MsgBox("저장 실패")
        '    End If
        'Else
        '    StrSQL = "Insert into CM_Order (CO_Code, CO_JOB, CO_PS_Code, 
        '                                    CO_PR_Code, CO_Customer_Name, CO_Item, 
        '                                    CO_Gold, CO_Date, CO_Deliver, 
        '                                    CO_WH, CO_Condition, CO_Bigo, 
        '                                    CO_Prepared, CO_Reviewed, CO_Approved) 
        '                           Values ('" & xworksheet.Range("J5").Value.ToString.Trim & "', '" & xworksheet.Range("J1").Value.ToString.Trim & "', '" & xworksheet.Range("J3").Value.ToString.Trim & "', 
        '                                   '" & xworksheet.Range("J2").Value.ToString.Trim & "', '" & xworksheet.Range("C7").Value.ToString.Trim & "', '" & xworksheet.Range("B10").Value.ToString.Trim & "', 
        '                                   '" & xworksheet.Range("I19").Value.ToString.Trim & "', '" & DateTime.Today.ToString("yyyy-MM-dd") & "', '" & xworksheet.Range("K10").Value.ToString.Trim & "', 
        '                                   '" & xworksheet.Range("J7").Value.ToString.Trim & "', '" & xworksheet.Range("J8").Value.ToString.Trim & "', '" & xworksheet.Range("A20").Value.ToString.Trim & "', 
        '                                   '" & xworksheet.Range("J22").Value.ToString.Trim & "', '" & xworksheet.Range("J25").Value.ToString.Trim + " / " + xworksheet.Range("J28").Value.ToString.Trim & "', '" & xworksheet.Range("J31").Value.ToString.Trim & "')"
        '    Re_Count2 = DB_Execute()

        '    StrSQL = "Select * from Contract where CR_Code = '" & xworksheet.Range("J1").Value.ToString.Trim & "'"
        '    DB_Select(DBT)

        '    RIR = "RIR" + xworksheet.Range("J1").Value.ToString.Substring(2, 7)
        '    StrSQL = "Select CQ_Code from CM_Stock_QC where CQ_Code Like '%" & RIR & "%' order by CQ_Code DESC"
        '    Re_Count = DB_Select(DBT2)
        '    If Re_Count > 0 Then
        '        RIR = DBT2.Rows(0)("CQ_Code").ToString.Substring(0, 11) + (Convert.ToInt32(DBT2.Rows(0)("CQ_Code").ToString.Substring(11, 3)) + 1).ToString("D3")
        '    Else
        '        RIR = "RIR" + xworksheet.Range("J1").Value.ToString.Substring(2, 7) + "-001"
        '    End If
        '    MsgBox(xworksheet.Range("J1").Value.ToString.Trim)
        '    StrSQL = "Insert into CM_Stock_QC (CQ_Code, CQ_JOB_Code, CQ_PS_Code, 
        '                                    CQ_PR_Code, CQ_PO_Code, CQ_Name, 
        '                                    CQ_Date, CQ_Time, CQ_Vendor_Name, 
        '                                    CQ_Vendor_Add, CQ_Customer_Code, CQ_Customer_Name, 
        '                                    CQ_Customer_Man_Name, CQ_Customer_Man_Tel, CQ_Manager,
        '                                    CQ_Day, CQ_Check, CQ_Bigo, CQ_FIle) 
        '                           Values ('" & RIR & "', '" & xworksheet.Range("J1").Value.ToString.Trim & "', '" & xworksheet.Range("J3").Value.ToString.Trim & "', 
        '                                   '" & xworksheet.Range("J2").Value.ToString.Trim & "', '" & xworksheet.Range("J5").Value.ToString.Trim & "', '" & DBT.Rows(0)("CR_Name").ToString & "', 
        '                                   '" & DateTime.Today.ToString("yyyy-MM-dd") & "', '" & "" & "', '" & xworksheet.Range("C7").Value.ToString.Trim & "', 
        '                                   '" & "" & "', '" & "" & "', '" & DBT.Rows(0)("CR_Customer_Name").ToString & "', 
        '                                   '" & "" & "', '" & "" & "', '" & xworksheet.Range("J22").Value.ToString.Trim & "',
        '                                   '" & xworksheet.Range("K10").Value.ToString.Trim & "', '" & "" & "', '" & "" & "', '" & "" & "')"
        '    DB_Execute()

        '    For i = 1 To 9
        '        If xworksheet.Range("B" + (i + 9).ToString).Value <> Nothing Then
        '            StrSQL = "Insert into CM_Order_List (CO_Code, CO_Sun, CO_PL_Code, 
        '                                         CO_PL_Name, CO_PL_List, CO_Standard, 
        '                                         CO_DwgNo, CO_Unit, CO_Qty, 
        '                                         CO_Amount, CO_Unit_Amount, CO_Total, 
        '                                         CO_day01, CO_Insu, CO_Pre_Name,
        '                                         CO_Rev_Name, CO_Deliver, CO_Bigo) 
        '                           Values ('" & xworksheet.Range("J5").Value.ToString.Trim & "', '" & i.ToString & "', '" & "" & "', 
        '                                   '" & xworksheet.Range("B" + (i + 9).ToString).Value.ToString.Trim & "', '" & "" & "', '" & "" & "', 

        '                                   '" & xworksheet.Range("D" + (i + 9).ToString).Value.ToString.Trim & "', '" & xworksheet.Range("E" + (i + 9).ToString).Value.ToString.Trim & "', '" & xworksheet.Range("F" + (i + 9).ToString).Value.ToString.Trim & "', 
        '                                   '" & xworksheet.Range("I" + (i + 9).ToString).Value.ToString.Trim & "', '" & xworksheet.Range("G" + (i + 9).ToString).Value.ToString.Trim & "', '" & "" & "', 
        '                                   '" & "" & "', '" & "" & "', '" & "" & "',
        '                                   '" & "" & "', '" & xworksheet.Range("K" + (i + 9).ToString).Value.ToString.Trim & "', '" & "" & "')"
        '            DB_Execute()
        '        End If

        '        If xworksheet.Range("B" + (i + 9).ToString).Value <> Nothing Then
        '            StrSQL = "Insert into CM_Stock_QC_List (CQ_Code, CQ_Sun, CQ_DRW_Code, 
        '                                         CQ_Item, CQ_Spec, CQ_Size, 
        '                                         CQ_Unit, CQ_Qty, CQ_CFSI, 
        '                                         CQ_MCE) 
        '                           Values ('" & RIR & "', '" & i.ToString & "', '" & xworksheet.Range("D" + (i + 9).ToString).Value.ToString.Trim & "', 
        '                                   '" & Split(xworksheet.Range("B" + (i + 9).ToString).Value.ToString, "/")(0).Trim & "', '" & Split(xworksheet.Range("B" + (i + 9).ToString).Value.ToString, "/")(1).Trim & "', '" & Split(xworksheet.Range("B" + (i + 9).ToString).Value.ToString, "/")(2).Trim & "', 

        '                                   '" & xworksheet.Range("E" + (i + 9).ToString).Value.ToString.Trim & "', '" & xworksheet.Range("F" + (i + 9).ToString).Value.ToString.Trim & "', '" & "" & "', 
        '                                   '" & "" & "')"
        '            DB_Execute()
        '        End If
        '    Next

        '    If Re_Count2 > 0 Then
        '        MsgBox("저장 완료")

        '    Else
        '        MsgBox("저장 실패")
        '    End If
        'End If


        'Label_Color(btnMain, Color_Label, Di_Panel2)
        'palMain.Visible = True
        'palDetail.Visible = False
        'Panel7.Visible = False
        'palSelect.Visible = False
        'CM_Load()
    End Sub

    Private Sub printType1_Click(sender As Object, e As EventArgs) Handles printType1.Click
        Dim i As Integer
        Dim sum As Integer = 0
        Dim count As Integer = lstDetail.RowCount - 1

        Dim DBT As DataTable
        DBT = Nothing
        xlapp = New Excel.Application
        xlbook = xlapp.Workbooks.Add(Application.StartupPath + "\\Excel\\구매팀\\발주서1.xlsx")
        xlsheet = xlbook.Worksheets(1)

        If lstDetail.RowCount > 9 Then
            count = 8
        End If

        Try
            If lstDetail.RowCount > 0 Then
                xlsheet.Range("J" + (1).ToString).Value = txtJobNo2.Text
                xlsheet.Range("J" + (2).ToString).Value = txtLOCode2.Text
                xlsheet.Range("J" + (3).ToString).Value = txtPSCode2.Text
                xlsheet.Range("J" + (5).ToString).Value = txtPOCode2.Text
                xlsheet.Range("C" + (7).ToString).Value = txtVendorName2.Text
                xlsheet.Range("C" + (8).ToString).Value = lstMain.Rows(lstMain.CurrentCell.RowIndex).Cells("CO_Customer_Addr").Value.ToString
                xlsheet.Range("J" + (7).ToString).Value = txtDeliverPlace2.Text
                xlsheet.Range("A" + (21).ToString).Value = txtBigo2.Text
                xlsheet.Range("J" + (22).ToString).Value = txtPrepared2.Text
                xlsheet.Range("J" + (25).ToString).Value = txtReviewedMS2.Text
                xlsheet.Range("J" + (28).ToString).Value = txtReviewedQA2.Text
                xlsheet.Range("J" + (31).ToString).Value = txtApprov2.Text
                xlsheet.Range("M" + (22).ToString).Value = dtpPrepared2.Value.ToString("yyyy-MM-dd")
                xlsheet.Range("M" + (25).ToString).Value = dtpReviewedMS2.Value.ToString("yyyy-MM-dd")
                xlsheet.Range("M" + (28).ToString).Value = dtpReviewedQA2.Value.ToString("yyyy-MM-dd")
                xlsheet.Range("M" + (31).ToString).Value = dtpApprov2.Value.ToString("yyyy-MM-dd")

                For i = 0 To count
                    sum += Convert.ToInt32(lstDetail.Rows(i).Cells("CO_Itm_Total_d").Value.ToString)
                    xlsheet.Range("A" + (i + 10).ToString).Value = i + 1
                    xlsheet.Range("B" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Name_d").Value.ToString & " / " & lstDetail.Rows(i).Cells("CO_Itm_Material_d").Value.ToString & " / " & lstDetail.Rows(i).Cells("CO_Itm_Spec_d").Value.ToString
                    xlsheet.Range("D" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_DV_Code_d").Value.ToString
                    xlsheet.Range("E" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Unit_Name_d").Value.ToString
                    xlsheet.Range("F" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Qty_d").Value.ToString
                    xlsheet.Range("G" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Unit_Price_d").Value.ToString
                    xlsheet.Range("I" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Total_d").Value.ToString
                    xlsheet.Range("K" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Delivery_Date_d").Value.ToString

                Next
                xlsheet.Range("I" + (19).ToString).Value = sum
                If SaveFileDialog1.ShowDialog = DialogResult.OK Then
                    xlapp.ActiveWorkbook.SaveAs(SaveFileDialog1.FileName)
                    MsgBox("Excel 저장 완료")
                    palSelect.Visible = False
                End If
            End If
        Catch ex As Exception
            MsgBox(ex.ToString)
        Finally
            xlapp.DisplayAlerts = False

            Try
                If xlbook IsNot Nothing Then
                    xlbook.Close(Nothing, Nothing, Nothing)
                End If
                xlapp.Workbooks.Close()
                xlapp.Quit()
                If xlsheet IsNot Nothing Then
                    Marshal.ReleaseComObject(xlsheet)
                End If
                If xlbook IsNot Nothing Then
                    Marshal.ReleaseComObject(xlbook)
                End If
                If xlapp IsNot Nothing Then
                    Marshal.ReleaseComObject(xlapp)
                End If

            Catch
            End Try
            xlsheet = Nothing
            xlbook = Nothing
            xlapp = Nothing
            GC.Collect()
            GC.WaitForPendingFinalizers()
        End Try

    End Sub

    Private Sub btnJobSearch_Click(sender As Object, e As EventArgs) Handles btnJobSearch.Click
        Dim pop1 As Frm_Contract_POP = New Frm_Contract_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            txtJobNo.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CR_Code").Value.ToString
            txtJobName.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CR_Name").Value.ToString
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnJobSearch2_Click(sender As Object, e As EventArgs) Handles btnJobSearch2.Click
        Dim pop1 As Frm_Contract_POP = New Frm_Contract_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            txtJobNo2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CR_Code").Value.ToString
            txtJobRev2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CR_Rev_No").Value.ToString
            txtJobName2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CR_Name").Value.ToString
        End If
        pop1.Dispose()
    End Sub

    Private Sub rbSrcVerifyYes2_CheckedChanged(sender As Object, e As EventArgs) Handles rbSrcVerifyYes2.CheckedChanged
        If rbSrcVerifyYes2.Checked Then
            rbSrcVerifyNo2.Checked = False
        Else
            rbSrcVerifyNo2.Checked = True
        End If
    End Sub

    Private Sub rbSrcVerifyNo2_CheckedChanged(sender As Object, e As EventArgs) Handles rbSrcVerifyNo2.CheckedChanged
        If rbSrcVerifyNo2.Checked Then
            rbSrcVerifyYes2.Checked = False
        Else
            rbSrcVerifyYes2.Checked = True
        End If
    End Sub

    Private Sub btnPSSearch2_Click(sender As Object, e As EventArgs) Handles btnPSSearch2.Click
        Dim pop1 As Frm_PS_POP = New Frm_PS_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            txtPSCode2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("PS_Code").Value.ToString
            txtPSRev2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("PS_Rev_No").Value.ToString
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnLOSearch2_Click(sender As Object, e As EventArgs) Handles btnLOSearch2.Click
        Dim pop1 As Frm_PR_POP = New Frm_PR_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            txtLOCode2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("LO_Code").Value.ToString
            txtLORev2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("LO_Rev_No").Value.ToString
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnGetPR_Click(sender As Object, e As EventArgs) Handles btnGetPR.Click

        Dim i%, j%
        Dim DBTinit As DataTable, DBT As DataTable, DBT2 As DataTable
        Dim initTgtCount As Int32
        DBTinit = Nothing
        DBT = Nothing
        DBT2 = Nothing

        Dim tmpLOCode As New String(String.Empty)
        Dim tmpLORevNo As New String(String.Empty)
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'Try

        '#1. popUp으로 PR 정보를 가져옴
        Dim pop1 As Frm_PR_POP = New Frm_PR_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) Then
            tmpLOCode = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("LO_Code").Value.ToString
            tmpLORevNo = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("LO_Rev_No").Value.ToString
        End If
        pop1.Dispose()
        '#2. 진행할 지 물어봄
        If MessageBox.Show("PR번호" & tmpLOCode & "/개정번호 " & tmpLORevNo & "의 전체항목을 PO 목록에 추가하시겠습니까?", "PR항목 가져오기", MessageBoxButtons.YesNo) = DialogResult.Yes Then

            '#3-1 PR 목록 가져오기
            StrSQL = "SELECT * from LA_Order_List where LO_Code = '" & tmpLOCode & "' And LO_Rev_No = " & tmpLORevNo & " order by LO_Sun asc "
            initTgtCount = DB_Select(DBTinit)
            If initTgtCount < 1 Then
                MessageBox.Show("PR번호" & tmpLOCode & "/개정번호 " & tmpLORevNo & "의 PR 목록이 존재하지 않습니다.", "PR항목 가져오기", MessageBoxButtons.OK)
                Exit Sub
            End If

            StrSQL = "SELECT * from CM_Order_List where 1=1 " &
                     " AND CO_Code = '" & txtPOCode2.Text & "' " &
                     " AND CO_Rev_No = " & txtRev2.Text
            Console.WriteLine("PO존재여부 SQL:" & StrSQL)
            Re_Count = DB_Select(DBT)

            '#3-2 BOM 목록과 중복되는 기존 PR목록 삭제 처리
            If Re_Count > 0 Then

                If MessageBox.Show("PR번호" & tmpLOCode & "/개정번호 " & tmpLORevNo & "의 항목이 PO 목록에 존재합니다. 삭제 후 진행하시겠습니까?", "PR항목 가져오기", MessageBoxButtons.YesNo) = DialogResult.Yes Then
                    StrSQL = " DELETE from CM_Order_List where 1=1 " &
                             " AND CO_Code = '" & txtPOCode2.Text & "' " &
                             " AND CO_Rev_No = " & txtRev2.Text
                    Re_Count = DB_Select(DBT)
                    If Re_Count > 0 Then
                        MessageBox.Show("PO번호" & txtPOCode2.Text & "/개정번호 " & txtRev2.Text & "의 기존 PO 목록을 삭제하였습니다.", "PR항목 가져오기", MessageBoxButtons.OK)
                    Else
                        MessageBox.Show("PO번호" & txtPOCode2.Text & "/개정번호 " & txtRev2.Text & "의 기존 PO 목록을 삭제에 실패하였습니다.", "PR항목 가져오기", MessageBoxButtons.OK)
                        Exit Sub
                    End If
                End If

            End If


            StrSQL = "SELECT isnull(max(CO_Sun),1) from CM_Order_List where CO_Code = '" & txtPOCode2.Text & "' And CO_Rev_No = " & txtRev2.Text
            Re_Count2 = DB_Select(DBT2)
            Dim tmpMaxSun As New Int32
            tmpMaxSun = Integer.Parse(DBT2.Rows(0).Item(0).ToString())

            For j = 0 To initTgtCount - 1

                '#3-3 하나씩 입력 
                tmpMaxSun += 1
                '#1. 기존 입력 값 초기화
                clearTblRowValues(tblCmOrderList)
                '#2. 입력자료 입력
                For i = 0 To tblCmOrderList.Rows.Count - 1

                    Select Case tblCmOrderList.Rows(i).Item(0).ToString

                        Case "CO_List_Code"
                            tblCmOrderList.Rows(i).Item(11) = PK_Make("CM_Order_List")
                        Case "CO_Code"
                            tblCmOrderList.Rows(i).Item(11) = txtPOCode2.Text
                        Case "CO_Rev_No"
                            tblCmOrderList.Rows(i).Item(11) = txtRev2.Text
                        Case "CO_Sun"
                            tblCmOrderList.Rows(i).Item(11) = tmpMaxSun.ToString
                        Case "CO_BO_List_Code"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_BO_List_Code").ToString
                        Case "CO_LO_List_Code"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_List_Code").ToString
                        Case "CO_Itm_Code"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Itm_Part_No").ToString
                        Case "CO_Itm_Name"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Itm_Part_Name").ToString
                        Case "CO_DV_Code"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_DV_Code").ToString
                        Case "CO_Itm_Desc"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Item_Desc").ToString
                        Case "CO_Itm_Spec"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Itm_Spec").ToString
                        Case "CO_Itm_Size"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Itm_Size").ToString
                        Case "CO_Itm_Unit"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Itm_Unit").ToString
                        Case "CO_Itm_Qty"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(j)("LO_Itm_Qty").ToString
                        Case "CO_Itm_Price"
                            tblCmOrderList.Rows(i).Item(11) = "0"
                        Case "CO_Itm_Unit_Price"
                            tblCmOrderList.Rows(i).Item(11) = "0"
                        Case "CO_Itm_Total"
                            tblCmOrderList.Rows(i).Item(11) = "0"
                        Case "CO_Itm_Delivery_Date"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(0)("LO_Itm_Delivery_Date").ToString
                        Case "CO_Itm_Bigo"
                            tblCmOrderList.Rows(i).Item(11) = DBTinit.Rows(0)("LO_Itm_bigo").ToString
                        Case "LO_Prepared"
                            tblCmOrderList.Rows(i).Item(11) = loginID
                        Case "LO_Prepare_Date"
                            tblCmOrderList.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                        Case "LO_Updated"
                            tblCmOrderList.Rows(i).Item(11) = loginID
                        Case "LO_Update_Date"
                            tblCmOrderList.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                    End Select
                Next


                Re_Count2 = fnTableInsert("dbo.CM_Order_List", tblCmOrderList)
                If Re_Count2 > 0 Then
                    'MsgBox("저장 완료")
                Else
                    MsgBox("저장 실패")
                    Exit Sub
                End If

            Next

        End If

        'hsim 20200515 처리 이력
        histLogStr = "사용자 " & logInUserName & " PO 항목정보 PR에서 가져오기 - 신규 입력 : " & txtPOCode2.Text & "-" & txtRev2.Text
        Man_Log("Frm_CM_Order", "신규입력", loginID & "-" & logInUserName, histLogStr, DateTime.Now.ToString(fmtStr2))

        'Catch ex As Exception

        'MsgBox(ex.Message)
        'Exit Sub

        'End Try

        CM_Detail_Load()

    End Sub

    Private Sub btnDelete_Click(sender As Object, e As EventArgs) Handles btnDelete.Click
        Dim DBT As DataTable
        DBT = Nothing
        If MessageBox.Show(txtPOCode2.Text + " 를 삭제하시겠습니까?" & vbCrLf & "상세 내용도 함께 삭제합니다", "삭제", MessageBoxButtons.YesNo) = DialogResult.Yes Then
            If txtLOCode2.Text <> "" Then
                StrSQL = "Delete CM_Order where CO_Code = '" & txtPOCode2.Text & "' and CO_Rev_No = " & txtRev2.Text & " "
                Re_Count = DB_Execute()
                StrSQL = "Delete CM_Order_List where CO_Code = '" & txtPOCode2.Text & "' and CO_Rev_No = " & txtRev2.Text & " "
                DB_Execute()
                If Re_Count > 0 Then
                    MsgBox("삭제 완료")
                End If
                'hsim 20200515 처리 이력
                histLogStr = "사용자 " & logInUserName & " PO 정보 삭제 : " & txtPOCode2.Text & "-" & txtRev2.Text
                Man_Log("Frm_CM_Order", "PO 정보 삭제", loginID, histLogStr, DateTime.Now.ToString(fmtStr2))
            Else
                MsgBox("선택된 PO No. 가 없습니다")
            End If
            CM_Load()
        End If
    End Sub

    Private Sub btnSave_Click(sender As Object, e As EventArgs) Handles btnSave.Click
        Dim i%
        Dim DBT As DataTable, DBT2 As DataTable
        DBT = Nothing
        DBT2 = Nothing

        Try

            StrSQL = "SELECT * from CM_Order where CO_Code = '" & txtPOCode2.Text & "' And CO_Rev_No = (SELECT max(CO_Rev_No) from CM_Order where CO_Code = '" & txtPOCode2.Text & "' and CO_Rev_No = '" & txtRev2.Text & "')"
            Re_Count = DB_Select(DBT)

            StrSQL = "SELECT * from CM_Order where CO_Code = '" & txtPOCode2.Text & "' And CO_Rev_No = (SELECT max(CO_Rev_No) from CM_Order where CO_Code = '" & txtPOCode2.Text & "')"
            Re_Count2 = DB_Select(DBT2)

            '#1. 기존 입력 값 초기화
            clearTblRowValues(tblCmOrder)
            '#2. 입력자료 입력
            For i = 0 To tblCmOrder.Rows.Count - 1

                Select Case tblCmOrder.Rows(i).Item(0).ToString

                    Case "CO_Code"
                        If txtPOCode2.Text <> "" Then
                            If Re_Count > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Code").ToString
                            ElseIf Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Code").ToString
                            End If
                        Else
                            tblCmOrder.Rows(i).Item(11) = PK_Make("CM_Order")
                        End If
                    Case "CO_Rev_No"
                        If txtRev2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtRev2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Rev_No").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Rev_No").ToString
                        Else
                            tblCmOrder.Rows(i).Item(11) = 1
                        End If
                    Case "CO_Name"
                        If txtPOName2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtPOName2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Name").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Name").ToString
                        End If
                    Case "CO_CR_Code"
                        If txtJobNo2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtJobNo2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_CR_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_CR_Code").ToString
                        End If
                    Case "CO_PS_Code"
                        If txtPSCode2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtPSCode2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_PS_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_PS_Code").ToString
                        End If
                    Case "CO_LO_Code"
                        If txtLOCode2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtLOCode2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_LO_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_LO_Code").ToString
                        End If
                    Case "CO_Customer_Code"
                        If txtVendorCode2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtVendorCode2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Customer_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Customer_Code").ToString
                        End If
                    Case "CO_Date"
                        If dtpRegDate2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpRegDate2.Value.ToString(fmtStr)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Date").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Date").ToString
                        End If
                    Case "CO_Deliever"
                        If dtpDeliver2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpDeliver2.Value.ToString(fmtStr)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Deliever").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Deliever").ToString
                        End If
                    Case "CO_WH"
                        If txtDeliverPlace2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtDeliverPlace2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_WH").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_WH").ToString
                        End If
                    Case "CO_Condition"
                        If txtCondition2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtCondition2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Condition").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Condition").ToString
                        End If
                    Case "CO_Bigo"
                        If txtBigo2.Text <> "" Then
                            tblCmOrder.Rows(i).Item(11) = txtBigo2.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Bigo").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Bigo").ToString
                        End If
                    Case "CO_Src_Verify_YN"
                        If rbSrcVerifyYes2.Checked Then
                            tblCmOrder.Rows(i).Item(11) = "Y"
                        ElseIf rbSrcVerifyNo2.Checked Then
                            tblCmOrder.Rows(i).Item(11) = "N"
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Src_Verify_YN").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Src_Verify_YN").ToString
                        End If
                    Case "CO_Prepared"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Prepared").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Prepared").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Updated"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Updated").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Updated").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Reviewed_MS"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Reviewed_MS").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Reviewed_MS").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Reviewed_QA"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Reviewed_QA").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Reviewed_QA").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Approved"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Approved").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Approved").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Deliever_Confirmed"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Deliever_Confirmed").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Deliever_Confirmed").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = ""
                            End If
                        End If
                    Case "CO_Prepare_Date"
                        If dtpPrepared2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpPrepared2.Value.ToString(fmtStr2)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Prepare_Date").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Prepare_Date").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                    Case "CO_Update_Date"
                        If Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Update_Date").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Update_Date").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                    Case "CO_Review_Date_MS"
                        If dtpReviewedMS2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpReviewedMS2.Value.ToString(fmtStr2)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Review_Date_MS").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Review_Date_MS").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                    Case "CO_Review_Date_QA"
                        If dtpReviewedQA2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpReviewedQA2.Value.ToString(fmtStr2)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Review_Date_QA").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Review_Date_QA").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                    Case "CO_Approve_Date"
                        If dtpApprov2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpApprov2.Value.ToString(fmtStr2)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Approve_Date").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Approve_Date").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                    Case "CO_Deliever_Date"
                        If dtpDeliver2.Value.ToString <> "" Then
                            tblCmOrder.Rows(i).Item(11) = dtpDeliver2.Value.ToString(fmtStr2)
                        ElseIf Re_Count > 0 Then
                            tblCmOrder.Rows(i).Item(11) = DBT.Rows(0)("CO_Deliever_Date").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrder.Rows(i).Item(11) = DBT2.Rows(0)("CO_Deliever_Date").ToString
                            Else
                                tblCmOrder.Rows(i).Item(11) = ""
                            End If
                        End If
                End Select
            Next



            If Re_Count > 0 Then
                Re_Count2 = fnTableUpdate("dbo.CM_Order", tblCmOrder)
                If Re_Count2 > 0 Then
                    MsgBox("저장 완료")
                Else
                    MsgBox("저장 실패")
                    Exit Sub
                End If
            Else
                Re_Count2 = fnTableInsert("dbo.CM_Order", tblCmOrder)
                If Re_Count2 > 0 Then
                    MsgBox("저장 완료")
                Else
                    MsgBox("저장 실패")
                    Exit Sub
                End If
            End If

            If Re_Count > 0 Then
                prcType = "수정" '수정
            Else
                prcType = "신규입력" '입력
            End If

            If prcType = "수정" Then
                'hsim 20200515 처리 이력
                histLogStr = "사용자 " & logInUserName & " PO 정보 수정 : " & txtPOCode2.Text & "-" & txtRev2.Text
            Else
                'hsim 20200515 처리 이력
                histLogStr = "사용자 " & logInUserName & " PO 정보 신규 입력 : " & txtPOCode2.Text & "-" & txtRev2.Text
            End If
            Man_Log("Frm_CM_Order", prcType, loginID & "-" & logInUserName, histLogStr, DateTime.Now.ToString(fmtStr2))

        Catch ex As Exception

            MsgBox(ex.Message)
            Exit Sub

        End Try

        CM_Load()

    End Sub

    Private Sub btnAdd_Click(sender As Object, e As EventArgs) Handles btnAdd.Click

        txtJobNo2.Text = ""
        txtJobName2.Text = ""
        txtPOName2.Text = ""
        txtJobRev2.Text = ""
        txtPOCode2.Text = ""
        dtpRegDate2.Value = DateTime.Now.ToString(fmtStr2)
        txtLOCode2.Text = ""
        txtLORev2.Text = ""
        txtPSCode2.Text = ""
        txtPSRev2.Text = ""
        txtVendorCode2.Text = ""
        txtVendorName2.Text = ""
        dtpDeliver2.Value = DateTime.Now.ToString(fmtStr2)
        'dtpDeliver2.CustomFormat = " "
        'dtpDeliver2.Format = DateTimePickerFormat.Custom
        txtDeliverPlace2.Text = ""
        txtCondition2.Text = ""
        txtBigo2.Text = ""
        txtPrepared2.Text = ""
        dtpPrepared2.Value = DateTime.Now.ToString(fmtStr2)
        txtReviewedMS2.Text = ""
        dtpReviewedMS2.Value = DateTime.Now.ToString(fmtStr2)
        'dtpReviewedMS2.CustomFormat = " "
        'dtpReviewedMS2.Format = DateTimePickerFormat.Custom
        txtReviewedQA2.Text = ""
        dtpReviewedQA2.Value = DateTime.Now.ToString(fmtStr2)
        'dtpReviewedQA2.CustomFormat = " "
        'dtpReviewedQA2.Format = DateTimePickerFormat.Custom
        txtApprov2.Text = ""
        dtpApprov2.Value = DateTime.Now.ToString(fmtStr2)
        'dtpApprov2.CustomFormat = " "
        'dtpApprov2.Format = DateTimePickerFormat.Custom

    End Sub

    Private Sub btnDWGSearch_Click(sender As Object, e As EventArgs) Handles btnDWGSearch.Click
        Dim pop1 As Frm_DV_POP = New Frm_DV_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            txtDWGCode3.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("DV_Code").Value.ToString
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnCustomerSearch_Click(sender As Object, e As EventArgs) Handles btnCustomerSearch.Click
        Dim cboDBT As New DataTable()
        Dim pop1 As Frm_Customer_POP = New Frm_Customer_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            cboDBT.Columns.Add("CM_Code")
            cboDBT.Columns.Add("CM_Name")
            cboDBT.Rows.Add()
            cboDBT.Rows(0).Item(0) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CM_Code").Value.ToString
            cboDBT.Rows(0).Item(1) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CM_Name").Value.ToString
            txtVendorName2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CM_Name").Value.ToString
            txtVendorCode2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("CM_Code").Value.ToString
            cboCustomer2.DataSource = cboDBT
            cboCustomer2.ValueMember = "CM_Code"
            cboCustomer2.DisplayMember = "CM_Name"
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnAdd2_Click(sender As Object, e As EventArgs) Handles btnAdd2.Click
        txtPOListCode3.Text = ""
        If lstDetail.RowCount > 0 Then
            txtSun3.Text = Convert.ToInt32(lstDetail.Rows(lstDetail.RowCount - 1).Cells("CO_Sun_d").Value.ToString) + 1
        Else
            txtSun3.Text = 1
        End If

        txtPOItmCode3.Text = ""
        txtPOItmName3.Text = ""
        txtMaterial3.Text = ""
        txtSpec3.Text = ""
        txtDWGCode3.Text = ""
        txtUPrice3.Text = ""
        txtQTY3.Text = ""
        txtUPrice3.Text = ""
        txtItmTotal3.Text = ""
        dtpDelivery3.Text = ""
        txtItmBigo3.Text = ""
    End Sub

    Private Sub btnDelete2_Click(sender As Object, e As EventArgs) Handles btnDelete2.Click
        Dim DBT As DataTable
        DBT = Nothing
        If MessageBox.Show("삭제하시겠습니까?", "삭제", MessageBoxButtons.YesNo) = DialogResult.Yes Then
            If txtPOCode3.Text <> "" Then
                StrSQL = "Delete CM_Order_List where CO_Code = '" & txtPOCode3.Text & "' and CO_Rev_No = '" & lstDetail.Rows(lstDetail.CurrentCell.RowIndex).Cells("CO_Rev_No").Value.ToString & "' and CO_Sun = " & txtSun3.Text
                Re_Count = DB_Execute()
                If Re_Count > 0 Then
                    MsgBox("삭제 완료")
                End If
                'hsim 20200515 처리 이력
                histLogStr = "사용자 " & logInUserName & " PO 항목 삭제 : " & txtPOCode3.Text & "-" &
                                 lstDetail.Rows(lstDetail.CurrentCell.RowIndex).Cells("CO_Rev_No").Value.ToString & "-" & txtSun3.Text
                Man_Log("Frm_CM_Order", "PO 항목 삭제", loginID, histLogStr, DateTime.Now.ToString(fmtStr2))
            Else
                MsgBox("선택된 PO No. 가 없습니다")
            End If
            CM_Load()
        End If
        btnAdd2.PerformClick()
    End Sub

    Private Sub btnSave2_Click(sender As Object, e As EventArgs) Handles btnSave2.Click
        Dim i%
        Dim DBT As DataTable, DBT2 As DataTable
        DBT = Nothing
        DBT2 = Nothing

        'hsim 20200515 개정이력 확인 정보
        Dim prcType As String
        Dim histLogStr As String

        Dim fmtStr As String, fmtStr2 As String
        fmtStr = String.Format("yyyy-MM-dd")
        fmtStr2 = String.Format("yyyy-MM-dd HH:mm:ss")

        Try

            StrSQL = "SELECT * from CM_Order_List where CO_Code = '" & txtPOCode3.Text & "' And CO_Rev_No = (SELECT max(CO_Rev_No) from CM_Order_List where CO_Code = '" & txtPOCode3.Text & "' and CO_Rev_No = '" & txtPORevNo3.Text & "')"
            Re_Count = DB_Select(DBT)

            StrSQL = "SELECT * from CM_Order_List where CO_Code = '" & txtPOCode3.Text & "' And CO_Rev_No = (SELECT max(CO_Rev_No) from CM_Order_List where CO_Code = '" & txtPOCode3.Text & "')"
            Re_Count2 = DB_Select(DBT2)

            '#1. 기존 입력 값 초기화
            clearTblRowValues(tblCmOrderList)
            '#2. 입력자료 입력
            For i = 0 To tblCmOrderList.Rows.Count - 1

                Select Case tblCmOrderList.Rows(i).Item(0).ToString

                    Case "CO_List_Code"
                        If txtPOListCode3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtPOListCode3.Text
                        Else
                            tblCmOrderList.Rows(i).Item(11) = PK_Make("CM_Order_List")
                        End If
                    Case "CO_Code"
                        If txtPOCode3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtPOCode3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Code").ToString
                        End If
                    Case "CO_Rev_No"
                        If txtPORevNo3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtPORevNo3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Rev_No").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Rev_No").ToString
                        Else
                            tblCmOrderList.Rows(i).Item(11) = 1
                        End If
                    Case "CO_Sun"
                        If txtSun3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtSun3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Sun").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Sun").ToString
                        End If
                    Case "CO_DV_Code"
                        If txtDWGCode3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtDWGCode3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_DV_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_DV_Code").ToString
                        End If
                    Case "CO_Itm_Name"
                        If txtPOItmName3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtPOItmName3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Name").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Name").ToString
                        End If
                    Case "CO_Itm_Code"
                        If txtPOItmCode3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtPOItmCode3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Code").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Code").ToString
                        End If
                    Case "CO_Itm_Material"
                        If txtMaterial3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtMaterial3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Material").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Material").ToString
                        End If
                    Case "CO_Itm_Spec"
                        If txtSpec3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtSpec3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Spec").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Spec").ToString
                        End If
                    Case "CO_Itm_Unit"
                        If cboItmUnit3.SelectedValue <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = cboItmUnit3.SelectedValue
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Unit").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Unit").ToString
                        End If
                    Case "CO_Itm_Qty"
                        If txtQTY3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtQTY3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Qty").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Qty").ToString
                        End If
                    Case "CO_Itm_Unit_Price"
                        If txtUPrice3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtUPrice3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Unit_Price").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Unit_Price").ToString
                        End If
                    Case "CO_Itm_Total"
                        If txtItmTotal3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtItmTotal3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Total").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Total").ToString
                        End If
                    Case "CO_Itm_Delivery_Date"
                        If dtpDelivery3.Value.ToString <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = dtpDelivery3.Value.ToString(fmtStr2)
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Delivery_Date").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Delivery_Date").ToString
                        End If
                    Case "CO_Itm_Bigo"
                        If txtItmBigo3.Text <> "" Then
                            tblCmOrderList.Rows(i).Item(11) = txtItmBigo3.Text
                        ElseIf Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Itm_Bigo").ToString
                        ElseIf Re_Count2 > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Itm_Bigo").ToString
                        End If
                    Case "CO_Prepared"
                        If Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Prepared").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Prepared").ToString
                            Else
                                tblCmOrderList.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Prepare_Date"
                        If Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Prepare_Date").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Prepare_Date").ToString
                            Else
                                tblCmOrderList.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                    Case "CO_Updated"
                        If Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Updated").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Updated").ToString
                            Else
                                tblCmOrderList.Rows(i).Item(11) = loginID
                            End If
                        End If
                    Case "CO_Update_Date"
                        If Re_Count > 0 Then
                            tblCmOrderList.Rows(i).Item(11) = DBT.Rows(0)("CO_Update_Date").ToString
                        Else
                            If Re_Count2 > 0 Then
                                tblCmOrderList.Rows(i).Item(11) = DBT2.Rows(0)("CO_Update_Date").ToString
                            Else
                                tblCmOrderList.Rows(i).Item(11) = DateTime.Now.ToString(fmtStr2)
                            End If
                        End If
                End Select
            Next



            If Re_Count > 0 Then
                Re_Count2 = fnTableUpdate("dbo.CM_Order_List", tblCmOrderList)
                If Re_Count2 > 0 Then
                    MsgBox("저장 완료")
                Else
                    MsgBox("저장 실패")
                    Exit Sub
                End If
            Else
                Re_Count2 = fnTableInsert("dbo.CM_Order_List", tblCmOrderList)
                If Re_Count2 > 0 Then
                    MsgBox("저장 완료")
                Else
                    MsgBox("저장 실패")
                    Exit Sub
                End If
            End If

            If Re_Count > 0 Then
                prcType = "수정" '수정
            Else
                prcType = "신규입력" '입력
            End If

            If prcType = "수정" Then
                'hsim 20200515 처리 이력
                histLogStr = "사용자 " & logInUserName & " PO 항목 정보 수정 : " & txtPOCode3.Text & "-" & txtPORevNo3.Text & "-" & txtSun3.Text
            Else
                'hsim 20200515 처리 이력
                histLogStr = "사용자 " & logInUserName & " PO 항목정보 신규 입력 : " & txtPOCode3.Text & "-" & txtPORevNo3.Text & "-" & txtSun3.Text
            End If
            Man_Log("Frm_CM_Order", prcType, loginID & "-" & logInUserName, histLogStr, DateTime.Now.ToString(fmtStr2))

        Catch ex As Exception

            MsgBox(ex.Message)
            Exit Sub

        End Try

        CM_Detail_Load()

    End Sub

    Private Sub btnApprovedSearch_Click(sender As Object, e As EventArgs) Handles btnApprovedSearch.Click
        Dim cboDBT As New DataTable()
        Dim pop1 As Frm_Man_POP = New Frm_Man_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            cboDBT.Columns.Add("Man_Code")
            cboDBT.Columns.Add("Man_Name")
            cboDBT.Rows.Add()
            cboDBT.Rows(0).Item(0) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Code").Value.ToString
            cboDBT.Rows(0).Item(1) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            txtApprov2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            cboApproved.DataSource = cboDBT
            cboApproved.ValueMember = "Man_Code"
            cboApproved.DisplayMember = "Man_Name"
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnReviewedQASearch_Click(sender As Object, e As EventArgs) Handles btnReviewedQASearch.Click
        Dim cboDBT As New DataTable()
        Dim pop1 As Frm_Man_POP = New Frm_Man_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            cboDBT.Columns.Add("Man_Code")
            cboDBT.Columns.Add("Man_Name")
            cboDBT.Rows.Add()
            cboDBT.Rows(0).Item(0) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Code").Value.ToString
            cboDBT.Rows(0).Item(1) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            txtReviewedQA2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            cboReviewedQA.DataSource = cboDBT
            cboReviewedQA.ValueMember = "Man_Code"
            cboReviewedQA.DisplayMember = "Man_Name"
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnReviewedMSSearch_Click(sender As Object, e As EventArgs) Handles btnReviewedMSSearch.Click
        Dim cboDBT As New DataTable()
        Dim pop1 As Frm_Man_POP = New Frm_Man_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            cboDBT.Columns.Add("Man_Code")
            cboDBT.Columns.Add("Man_Name")
            cboDBT.Rows.Add()
            cboDBT.Rows(0).Item(0) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Code").Value.ToString
            cboDBT.Rows(0).Item(1) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            txtReviewedMS2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            cboReviewedMS.DataSource = cboDBT
            cboReviewedMS.ValueMember = "Man_Code"
            cboReviewedMS.DisplayMember = "Man_Name"
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnPreparedSearch_Click(sender As Object, e As EventArgs) Handles btnPreparedSearch.Click
        Dim cboDBT As New DataTable()
        Dim pop1 As Frm_Man_POP = New Frm_Man_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            cboDBT.Columns.Add("Man_Code")
            cboDBT.Columns.Add("Man_Name")
            cboDBT.Rows.Add()
            cboDBT.Rows(0).Item(0) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Code").Value.ToString
            cboDBT.Rows(0).Item(1) = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            txtPrepared2.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("Man_Name").Value.ToString
            cboPrepared.DataSource = cboDBT
            cboPrepared.ValueMember = "Man_Code"
            cboPrepared.DisplayMember = "Man_Name"
        End If
        pop1.Dispose()
    End Sub

    Private Sub btnLOSearchTop_Click(sender As Object, e As EventArgs) Handles btnLOSearchTop.Click
        Dim pop1 As Frm_PR_POP = New Frm_PR_POP
        pop1.StartPosition = FormStartPosition.CenterScreen
        If (pop1.ShowDialog(Me) = DialogResult.OK) And pop1.DataGridView1.Rows.Count > 0 Then
            txtPRNo.Text = pop1.DataGridView1.Rows(pop1.DataGridView1.CurrentCell.RowIndex).Cells("LO_Code").Value.ToString
        End If
        pop1.Dispose()
    End Sub

    Private Sub txtUPrice_TextChanged(sender As Object, e As EventArgs) Handles txtUPrice3.TextChanged
        Dim result As Integer, A As Integer, B As Long
        If txtUPrice3.Text = "" Then
            txtUPrice3.Text = "0"
        End If
        If txtQTY3.Text = "" Then
            txtQTY3.Text = "0"
        End If
        A = CInt(txtUPrice3.Text)
        B = CInt(txtQTY3.Text)
        result = A * B
        txtItmTotal3.Text = result.ToString
    End Sub

    Private Sub lstDetail_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles lstDetail.CellClick
        txtPOListCode3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_List_Code_d").Value.ToString
        txtPOCode3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Code_d").Value.ToString
        txtPORevNo3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Rev_No_d").Value.ToString
        txtSun3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Sun_d").Value.ToString
        txtPOItmCode3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Code_d").Value.ToString
        txtPOItmName3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Name_d").Value.ToString
        txtMaterial3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Material_d").Value.ToString
        txtSpec3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Spec_d").Value.ToString
        txtDWGCode3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_DV_Code_d").Value.ToString
        cboItmUnit3.SelectedValue = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Unit_d").Value.ToString
        txtQTY3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Qty_d").Value.ToString
        txtUPrice3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Unit_Price_d").Value.ToString
        txtItmTotal3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Total_d").Value.ToString
        dtpDelivery3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Delivery_Date_d").Value.ToString
        txtItmBigo3.Text = lstDetail.Rows(lstDetail.CurrentRow.Index).Cells("CO_Itm_Bigo_d").Value.ToString
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        palSelect.Visible = True
        palSelect.BringToFront()
    End Sub

    Private Sub Com_End_Click(sender As Object, e As EventArgs) Handles Com_End.Click
        palSelect.Visible = False
    End Sub

    Private Sub printType2_Click(sender As Object, e As EventArgs) Handles printType2.Click
        Dim i As Integer
        Dim sum As Integer = 0
        Dim count As Integer = lstDetail.RowCount - 1

        Dim DBT As DataTable
        DBT = Nothing
        xlapp = New Excel.Application
        xlbook = xlapp.Workbooks.Add(Application.StartupPath + "\\Excel\\구매팀\\발주서2.xlsx")
        xlsheet = xlbook.Worksheets(1)

        If lstDetail.RowCount > 10 Then
            count = 9
        End If

        Try
            If lstDetail.RowCount > 0 Then
                xlsheet.Range("J" + (1).ToString).Value = txtJobNo2.Text
                xlsheet.Range("J" + (2).ToString).Value = txtLOCode2.Text
                xlsheet.Range("J" + (3).ToString).Value = txtPSCode2.Text
                xlsheet.Range("J" + (5).ToString).Value = txtPOCode2.Text
                xlsheet.Range("C" + (7).ToString).Value = txtVendorName2.Text
                xlsheet.Range("C" + (8).ToString).Value = lstMain.Rows(lstMain.CurrentCell.RowIndex).Cells("CO_Customer_Addr").Value.ToString
                xlsheet.Range("J" + (7).ToString).Value = txtDeliverPlace2.Text
                xlsheet.Range("A" + (22).ToString).Value = txtBigo2.Text
                xlsheet.Range("J" + (23).ToString).Value = txtPrepared2.Text
                xlsheet.Range("J" + (24).ToString).Value = txtReviewedMS2.Text
                xlsheet.Range("J" + (29).ToString).Value = txtReviewedQA2.Text
                xlsheet.Range("J" + (32).ToString).Value = txtApprov2.Text
                xlsheet.Range("M" + (23).ToString).Value = dtpPrepared2.Value.ToString("yyyy-MM-dd")
                xlsheet.Range("M" + (26).ToString).Value = dtpReviewedMS2.Value.ToString("yyyy-MM-dd")
                xlsheet.Range("M" + (29).ToString).Value = dtpReviewedQA2.Value.ToString("yyyy-MM-dd")
                xlsheet.Range("M" + (32).ToString).Value = dtpApprov2.Value.ToString("yyyy-MM-dd")

                For i = 0 To count
                    sum += Convert.ToInt32(lstDetail.Rows(i).Cells("CO_Itm_Total_d").Value.ToString)
                    xlsheet.Range("A" + (i + 10).ToString).Value = i + 1
                    xlsheet.Range("B" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Name_d").Value.ToString & " / " & lstDetail.Rows(i).Cells("CO_Itm_Material_d").Value.ToString & " / " & lstDetail.Rows(i).Cells("CO_Itm_Spec_d").Value.ToString
                    xlsheet.Range("D" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_DV_Code_d").Value.ToString
                    xlsheet.Range("E" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Unit_Name_d").Value.ToString
                    xlsheet.Range("F" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Qty_d").Value.ToString
                    xlsheet.Range("G" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Unit_Price_d").Value.ToString
                    xlsheet.Range("I" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Total_d").Value.ToString
                    xlsheet.Range("K" + (i + 10).ToString).Value = lstDetail.Rows(i).Cells("CO_Itm_Delivery_Date_d").Value.ToString

                Next
                xlsheet.Range("I" + (20).ToString).Value = sum
                If SaveFileDialog1.ShowDialog = DialogResult.OK Then
                    xlapp.ActiveWorkbook.SaveAs(SaveFileDialog1.FileName)
                    MsgBox("Excel 저장 완료")
                    palSelect.Visible = False
                End If
            End If
        Catch ex As Exception
            MsgBox(ex.ToString)
        Finally
            xlapp.DisplayAlerts = False

            Try
                If xlbook IsNot Nothing Then
                    xlbook.Close(Nothing, Nothing, Nothing)
                End If
                xlapp.Workbooks.Close()
                xlapp.Quit()
                If xlsheet IsNot Nothing Then
                    Marshal.ReleaseComObject(xlsheet)
                End If
                If xlbook IsNot Nothing Then
                    Marshal.ReleaseComObject(xlbook)
                End If
                If xlapp IsNot Nothing Then
                    Marshal.ReleaseComObject(xlapp)
                End If

            Catch
            End Try
            xlsheet = Nothing
            xlbook = Nothing
            xlapp = Nothing
            GC.Collect()
            GC.WaitForPendingFinalizers()
        End Try

    End Sub

    Private Sub txtQTY3_TextChanged(sender As Object, e As EventArgs) Handles txtQTY3.TextChanged
        Dim result As Integer, A As Integer, B As Long
        If txtUPrice3.Text = "" Then
            txtUPrice3.Text = "0"
        End If
        If txtQTY3.Text = "" Then
            txtQTY3.Text = "0"
        End If
        A = CInt(txtUPrice3.Text)
        B = CInt(txtQTY3.Text)
        result = A * B
        txtItmTotal3.Text = result.ToString
    End Sub

End Class
